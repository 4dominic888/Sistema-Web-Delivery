@using Delivery.Domain.Order
@using Delivery.Domain.Food
@model IEnumerable<Pedido>
@{

}

<div class="container mt-4">
    <h3>Pedidos</h3>
    <br>

    <div class="row container">

        @if (Model.Count() > 0)
        {
            <table id="tabla_pedidos" class="table">
                <thead>
                    <tr>
                        <th scope="col">Código</th>
                        <th scope="col">Detalle</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Repartidor asignado</th>
                        <th scope="col">Acción</th>
                    </tr>
                </thead>
                <tbody>

                    @{

                    }

                    @foreach(var item in Model)
                    {
                        <tr>
                            <th scope="row">@item.Codigo</th>
                            <td>
                                <button class="btn btn-dark detalle" data-id="@item.Codigo">Ver detalle</button>
                            </td>

                            @if(item.Estado == EstadoPedido.En_Proceso)
                            {
                                <td>En proceso</td>
                            }
                            else
                            {
                                <td>@item.Estado</td>
                            }
                            @if (item.IdRepartidor is null)
                            {
                                <td>No asignado</td>
                            }
                            else
                            {
                                <td>
                                    @item.Repartidor.Name
                                </td>
                            }
                            <td>
                                <button class="btn btn-danger">Cancelar pedido</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else{
            <div class="alert alert-primary" role="alert">
                No tiene ningún pedido en el historial
            </div>
        }
    </div>

    <div id="contenedor_detalle">
        @await Html.PartialAsync("_DetallePedido", Enumerable.Empty<Comida_CaracteristicaPedido>())
    </div>

</div>

@section Scripts{
    <script>
        $("#tabla_pedidos").DataTable({
            "language":{
                url: "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
            }
        });

        $('.btn.btn-dark.detalle').on("click", function(){
            let valor = $(this).data("id");

            $.ajax({
                type: 'GET',
                url: '/Pedido/_DetallePedido',
                data: { id: valor },
                dataType: 'html',
                async: true,
                success: function (result) {
                    $('#contenedor_detalle').html(result);
                    $('#formulario').attr("action", "/Comida/EditarComida");
                    $('#offcanvas_detalle').offcanvas('show');
                }
            });
        });

    </script>
}